<!DOCTYPE html>
<html lang="es">
<head>
    <!-- (Mismos metadatos, CSS y scripts que antes) -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMC Saludable</title>
    <link rel="apple-touch-icon" href="icono.png">
    <link rel="icon" type="image/png" href="icono.png">
    <meta name="theme-color" content="#4CAF50">
    <meta name="author" content="MARIO ANDR√âS NARV√ÅEZ DELGADO">
    <meta name="description" content="Calculadora de IMC con recomendaciones personalizadas. Desarrollada por MARIO ANDR√âS NARV√ÅEZ DELGADO.">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- (Todos los estilos CSS que ya ten√≠amos, incluido el modo oscuro) -->
    <style>
        /* (Tus estilos CSS anteriores, incluyendo colores por categor√≠as y modo oscuro) */
        body { /* ... */ }
        body.dark-mode { /* ... */ }
        #texto-explicativo strong { /* ... */ }
        /* ... (el resto de tu CSS) ... */
    </style>
</head>
<body>
    <div class="container">
        <h1>IMC Saludable<br>
            <small style="font-size: 0.6em; color: #666;">por MARIO ANDR√âS NARV√ÅEZ DELGADO</small>
        </h1>
        
        <!-- (Tus inputs y botones existentes) -->
        <input type="number" id="peso" placeholder="Peso (kg)" step="0.1">
        <input type="number" id="altura" placeholder="Altura (m o cm)">
        <select id="actividad" style="width: 80%;">
            <option value="1.2">Actividad: Sedentario</option>
            <option value="1.5" selected>Actividad: Moderado</option>
            <option value="1.8">Actividad: Activo</option>
        </select>
        <button onclick="calcularIMC()">Calcular</button>
        <button onclick="toggleDarkMode()" id="btnDarkMode">üåì</button>
        <button onclick="descargarPDF()" id="btnPDF" class="oculto">üì• PDF</button>
        <button onclick="verHistorial()" id="btnHistorial" class="oculto">üìä Historial</button>
        
        <!-- (Tu progress bar y resultado) -->
        <div class="progress"><div class="progress-bar" id="barra"></div></div>
        <div id="resultado"></div>
        
        <!-- EXPLICACIONES Y RECOMENDACIONES (¬°aqu√≠ est√° el c√≥digo faltante!) -->
        <div id="explicacion" class="oculto">
            <h3>¬øQu√© significa tu IMC?</h3>
            <p id="texto-explicativo"></p>
            <div id="recomendaciones">
                <h4>Recomendaciones:</h4>
                <ul id="lista-recomendaciones"></ul>
            </div>
            <p><small>Consulta siempre a un profesional de la salud.</small></p>
        </div>
        
        <!-- (Historial y gr√°fico, igual que antes) -->
        <div id="historial" class="oculto">
            <h3>Historial de c√°lculos</h3>
            <ul id="lista-historial"></ul>
            <canvas id="graficoIMC" class="oculto"></canvas>
        </div>
    </div>
    <footer>Desarrollado por <strong>MARIO ANDR√âS NARV√ÅEZ DELGADO</strong> ‚Ä¢ 2024</footer>

    <script>
        // 1. DICCIONARIO DE EXPLICACIONES (¬°igual que antes!)
        const explicaciones = {
            bajo_peso: {
                titulo: "Bajo peso ‚ö†Ô∏è",
                texto: "Tu IMC es inferior a 18.5. Puede asociarse a desnutrici√≥n, baja masa muscular o problemas digestivos.",
                recomendaciones: [
                    "Aumenta tu ingesta cal√≥rica con alimentos nutritivos (frutos secos, aguacates, prote√≠nas magras).",
                    "Haz ejercicio de fuerza (pesas o entrenamiento funcional) para ganar masa muscular.",
                    "Consulta a un nutricionista para evaluar tu situaci√≥n."
                ]
            },
            normal: { /* ... (igual que antes) ... */ },
            sobrepeso: { /* ... (igual que antes) ... */ },
            obesidad: { /* ... (igual que antes) ... */ }
        };

        // 2. FUNCI√ìN PARA MOSTRAR EXPLICACIONES (¬°igual que antes!)
        function mostrarExplicacion(imc) {
            let clave;
            if (imc < 18.5) clave = "bajo_peso";
            else if (imc < 25) clave = "normal";
            else if (imc < 30) clave = "sobrepeso";
            else clave = "obesidad";

            const data = explicaciones[clave];
            document.getElementById("texto-explicativo").innerHTML = `
                <strong>${data.titulo}</strong><br>${data.texto}
            `;
            const lista = document.getElementById("lista-recomendaciones");
            lista.innerHTML = "";
            data.recomendaciones.forEach(rec => {
                lista.innerHTML += `<li>${rec}</li>`;
            });
            document.getElementById("explicacion").classList.remove("oculto");
        }

        // 3. FUNCI√ìN PRINCIPAL (¬°ahora llama a mostrarExplicacion!)
        let imc_redondeado, categoria;
        function calcularIMC() {
            try {
                // (Tu l√≥gica de c√°lculo de IMC y clasificaci√≥n)
                const peso = parseFloat(document.getElementById("peso").value);
                let altura = parseFloat(document.getElementById("altura").value);
                if (isNaN(peso) || isNaN(altura)) throw new Error("Ingresa valores v√°lidos.");
                if (altura > 3) altura /= 100;

                const imc = peso / (altura ** 2);
                imc_redondeado = Math.round(imc * 100) / 100;
                if (imc < 18.5) categoria = "Bajo peso ‚ö†Ô∏è";
                else if (imc < 25) categoria = "Peso normal ‚úÖ";
                else if (imc < 30) categoria = "Sobrepeso ‚ö†Ô∏è";
                else if (imc < 35) categoria = "Obesidad I ‚ùå";
                else if (imc < 40) categoria = "Obesidad II ‚ùå";
                else categoria = "Obesidad III (m√≥rbida) ‚ùå";

                // (Mostrar resultados y llamar a mostrarExplicacion)
                const actividad = parseFloat(document.getElementById('actividad').value);
                const tmb = 10 * peso + 6.25 * (altura * 100) - 5 * 25 + 5;
                const calorias = Math.round(tmb * actividad);

                document.getElementById("resultado").innerHTML = `
                    <h2>IMC: ${imc_redondeado}</h2>
                    <p>${categoria}</p>
                    <p>Calor√≠as diarias recomendadas: <strong>${calorias}</strong></p>
                `;
                document.getElementById("barra").style.width = `${Math.min(imc, 40)}%`;

                // ¬°MOSTRAR EXPLICACIONES AHORA!
                mostrarExplicacion(imc);

                // (Botones PDF y historial)
                document.getElementById("btnPDF").classList.remove("oculto");
                document.getElementById("btnHistorial").classList.remove("oculto");
                guardarEnHistorial(imc_redondeado, categoria);

            } catch (error) {
                alert("Error: " + error.message);
            }
        }

        // (Resto de tus funciones: guardarEnHistorial, verHistorial, descargarPDF, toggleDarkMode)
        function guardarEnHistorial(imc, categoria) { /* ... */ }
        function verHistorial() { /* ... */ }
        function descargarPDF() { /* ... */ }
        function toggleDarkMode() { /* ... */ }

        // (Inicializaci√≥n de modo oscuro y Chart.js)
        if (localStorage.getItem('darkMode') === 'true') document.body.classList.add('dark-mode');
        const chartScript = document.createElement('script');
        chartScript.src = 'https://cdn.jsdelivr.net/npm/chart.js';
        document.head.appendChild(chartScript);
    </script>
</body>
</html>
